#!/usr/bin/env node
!function(x,c,s,u,l,h,p){"use strict";x=x&&x.hasOwnProperty("default")?x.default:x,c=c&&c.hasOwnProperty("default")?c.default:c,s=s&&s.hasOwnProperty("default")?s.default:s,u=u&&u.hasOwnProperty("default")?u.default:u,l=l&&l.hasOwnProperty("default")?l.default:l,h=h&&h.hasOwnProperty("default")?h.default:h,p=p&&p.hasOwnProperty("default")?p.default:p;function o(e,t){t.fail("".concat(e)),process.exit(1),removeHTML()}var n=require("events"),e=require("util"),f=require("fs-extra"),d=e.promisify(f.writeFile),i=require("rimraf"),m=require("sanitize-html"),v=(require("path"),require("cheerio")),t=function(e){function r(e,t){var n;return s(this,r),(n=l(this,h(r).call(this))).data=e,n.spinner=t,n.data&&c(x.mark(function e(){return x.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.buildEpubFiles(n.data);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),o(e.t0,n.spinner);case 8:case"end":return e.stop()}},e,null,[[0,5]])}))(),n}var t;return p(r,n),u(r,[{key:"removeHTML",value:function(){i("html/",function(){return!0})}},{key:"createReformatedHashLinkArrAndcreateLinkArr",value:function(n){return new Promise(function(e,t){if(""===n)t(new Error("Something went wrong. Please try again."),null);else{var r=[],i=[];n.pages.forEach(function(e){var t=void 0!==e.reformatedHashLinkArr?e.reformatedHashLinkArr:"";r.push(t);var n=void 0!==e.linkTitleArr?e.linkTitleArr:"";i.push(n)}),e([i,r])}})}},{key:"buildMetadata",value:function(l){return new Promise(function(e,t){if(""===l)t(new Error("Something went wrong. Please try again."),null);else if(void 0===l.title||null===l.title||""===l.title)t(new Error("A title for your publication must be specified in the publication.yml file."),null);else if(void 0===l.language||null===l.language||""===l.language)t(new Error("A language for your publication must be specified in the publication.yml file."),null);else{delete l.pages;var n="";for(var r in l)if(void 0!==l[r]&&null!==l[r]&&"string"!=typeof l[r]){if(0<l[r].length){var i=l[r];if("creators"===r){for(var o in i)if(i.hasOwnProperty(o)&&void 0!==i[o]&&null!==i[o]&&""!==i[o]){var a=i[o];!0===a.fullname?n+='<dc:creator opf:role="'.concat(a.role,'">').concat(a.name,"</dc:creator>"):n+='<dc:creator opf:file-as="'.concat(a["file-as"],'" opf:role="').concat(a.role,'">').concat(a.name,"</dc:creator>")}}else if("contributors"===r){for(var c in i)if(i.hasOwnProperty(c)&&void 0!==i[c]&&null!==i[c]&&""!==i[c]){var s=i[c];!0===s.fullname?n+='<dc:contributor opf:role="'.concat(s.role,'">').concat(s.name,"</dc:contributor>"):n+='<dc:contributor opf:file-as="'.concat(s["file-as"],'" opf:role="').concat(s.role,'">').concat(s.name,"</dc:contributor>")}}else for(var u in i)!i.hasOwnProperty(u)||void 0!==i[u]&&null!==i[u]&&""!==i[u]&&(n+="<dc:".concat(u,">").concat(i[u],"</dc:").concat(u,">"))}}else"title"===r||void 0!==l[r]&&null!==l[r]&&""!==l[r]&&(n+="<dc:".concat(r,">").concat(l[r],"</dc:").concat(r,">"));d("html/dc.xml",n),e(n)}})}},{key:"buildHTML",value:function(s,u,l){return new Promise(function(e,r){if(""===s||""===u||""===l)r(new Error("Something went wrong. Please try again."),null);else{var n=[];s.pages.forEach(function(e){var t=void 0!==e.body?e.body:"";n.push(t)});var t=n.join(" ");t=function(e){return e=m(e,{allowedTags:["h1","h2","h3","h4","h5","h6","blockquote","p","a","ul","ol","nl","li","b","i","strong","em","hr","br","div","table","thead","caption","tbody","tr","th","td","dl","dt","dd","pre","html","title","iframe","header","footer","body","form","img","meta","link","strike","code","main","article","section","aside","span","figure","sup","sub","figcaption"],allowedAttributes:{a:["href","name","target","class","id"],img:["src","width","height","class","id"],iframe:["src","width","height","class","id"],div:["id","class"],main:["id","class"],article:["id","class"],ul:["id","class"],ol:["id","class"],li:["id","class"],nav:["id","class"],meta:["name","content"],link:["rel","href"],p:["id","class"],h1:["id","class"],h2:["id","class"],h3:["id","class"],h4:["id","class"],h5:["id","class"],h6:["id","class"],span:["id","class"],sup:["id","class"],sub:["id","class"],figure:["id","class"],figcaption:["id","class"],blockquote:["id","class"],table:["id","class"],td:["id","class"],tr:["id","class"],th:["id","class"],dl:["id","class"],dt:["id","class"],dd:["id","class"],html:["id","class"],body:["id","class"],section:["id","class"],aside:["id","class"]},selfClosing:["br","hr","area","base","basefont","input","meta","img"],allowedSchemes:["http","https","ftp","mailto"],allowedSchemesByTag:{},allowedSchemesAppliedToAttributes:[],allowProtocolRelative:!0,allowedIframeHostnames:["www.youtube.com","player.vimeo.com"]})}(t);var i="\n                <!DOCTYPE html>\n                <html>\n                  <head>\n                    <title>".concat(s.title,"</title>\n                  </head>\n                  <body>\n                    <div>\n                      ").concat(t,"\n                    </div>\n                  </body>\n                </html>\n                "),a=v.load(i,{decodeEntities:!1}),o=a("html"),c={};o.find("[id]").attr("id",function(e,t){return c[t]=(c[t]||0)+1,-1!==t.indexOf("fn-")||-1!==t.indexOf("fnref-")?t:1<c[t]?t="".concat(t,"-").concat(c[t]):t}),o.find(".remove-from-epub, .visually-hidden, .is-screen-only, .is-print-only").remove(),o.find(".quire-figure--group").each(function(e,t){var n=a(t).html();return a(t).replaceWith("".concat(n))}),o.find("figure").each(function(e,t){var n=void 0!==a(t).find("img").attr("id")?'id="'.concat(a(t).find("img").attr("id"),'"'):"",r=void 0!==a(t).find("img").attr("src")?'src="'.concat(a(t).find("img").attr("src"),'"'):"",i=null!==a(t).find("figcaption").html()?"<figcaption>".concat(a(t).find("figcaption").html(),"</figcaption>"):"";return a(t).replaceWith("<span ".concat(n,"></span><figure><img ").concat(r,"/>").concat(i,"</figure>"))}),o.find("a").attr("href",function(e,t){if(-1!==t.indexOf("empty")){var n=t.replace("#empty-","");r(new Error("Fragment identifier on page ".concat(n,' of <a href="#"></a> could not be found. Please correct this and try again.')),null)}return function(e,t){if(e.match(/^(https|http|www)/))return e;if(-1!==e.indexOf("#")){for(var n=e.split("#"),r=0;r<t.length;r++){var i=t[r].link.replace(/[^a-zA-Z0-9 ]/g,"");if(n[0].replace(/[^a-zA-Z0-9 ]/g,"")===i)return e="#".concat(n[1],"-").concat(t[r].title)}return e}for(var o=0;o<t.length;o++)if(e===t[o].link)return e="#".concat(t[o].title);return e}(t,u)}),o.find("sup").each(function(e,t){var n=a(t).attr(),r=a(t).html(),i=void 0!==n.class?'class="'.concat(n.class,'"'):"",o=void 0!==n.id?'id="'.concat(n.id,'"'):"";return a(t).replaceWith("<sup><span ".concat(i," ").concat(o,">").concat(r,"</span></sup>"))}),f.existsSync("epub/template.xhtml")?f.copyFileSync("epub/template.xhtml","html/template.xhtml"):d("html/template.xhtml",'<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE html>\n<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" $if(lang)$ xml:lang="$lang$" $endif$>\n\n<head>\n    <meta charset="utf-8" />\n    <meta name="generator" content="pandoc" />\n    <title>$pagetitle$</title>\n    <style type="text/css">\n        $if(quotes)$ q {\n            quotes: "“" "”" "‘" "’";\n        }\n\n        $endif$\n    </style>\n    $if(highlighting-css)$\n    <style type="text/css">\n        $highlighting-css$\n    </style>\n    $endif$ $for(css)$\n    <link rel="stylesheet" type="text/css" href="$css$" /> $endfor$ $for(header-includes)$ $header-includes$ $endfor$\n</head>\n<body$if(coverpage)$ id="cover" $endif$>\n    \n    $if(titlepage)$\n    <section epub:type="titlepage">\n        $for(title)$ $if(title.type)$\n        <h1 class="$title.type$">$title.text$</h1>\n        $else$\n        <h1 class="title">$title$</h1>\n        $endif$ $endfor$ $if(subtitle)$\n        <p class="subtitle">$subtitle$</p>\n        $endif$ $for(author)$\n        <p class="author">$author$</p>\n        $endfor$ $for(creator)$\n        <p class="$creator.role$">$creator.text$</p>\n        $endfor$ $if(publisher)$\n        <p class="publisher">$publisher$</p>\n        $endif$ $if(date)$\n        <p class="date">$date$</p>\n        $endif$ $if(rights)$\n        <div class="rights">$rights$</div>\n        $endif$\n    </section>\n    $else$ \n\n    $for(include-before)$ \n    $include-before$ \n    $endfor$ \n    \n    $body$ \n    \n    $for(include-after)$ \n    $include-after$ \n    $endfor$ \n\n    $endif$\n    </body>\n\n</html>'),d("html/epub.xhtml",o),e(a.html())}})}},{key:"buildEpubFiles",value:(t=c(x.mark(function e(n){var r,i=this;return x.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,"./html",f.existsSync("./html")||f.mkdirSync("./html"),t.next=5,this.createReformatedHashLinkArrAndcreateLinkArr(n);case 5:return r=t.sent,t.next=8,this.buildHTML(n,r[0],r[1]);case 8:return t.next=10,this.buildMetadata(n);case 10:return t.abrupt("return",new Promise(function(e){e(!0)}));case 13:return t.prev=13,t.t0=t.catch(0),t.abrupt("return",new Promise(function(e){e(!0),o(t.t0,i.spinner)}));case 16:case"end":return t.stop()}},e,this,[[0,13]])})),function(e){return t.apply(this,arguments)})}]),r}();module.exports=t;var a=require("cheerio"),g=require("path"),r=require("upath"),b=function(){function i(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{outputDir:"site",imageDir:"img"};s(this,i),this.config=n,this.epubTitle=t,this.$=a.load(e),this.content=this.$("#main")||this.$(".quire__primary__inner"),this.title=this.determineTitle(),this.chapterId=this.determineChapterId(),this.images=this.content.find("img"),this.links=this.content.find("a"),this.reformatedHashLinkArr="",this.reformatPage();var r={title:this.title,body:this.body(),reformatedHashLinkArr:this.reformatedHashLinkArr};return this.href()&&(r.linkTitleArr={},r.href=this.href(),r.linkTitleArr.link=this.santizeUrl(this.href()),r.linkTitleArr.title=this.pandocTitle(this.chapterId)),new Promise(function(e){e(r)})}return u(i,[{key:"santizeUrl",value:function(e){if(void 0!==e)return e=e.toLowerCase().trim().replace(".xhtml","").replace(/^\//,"").replace(/\/$/,"").replace(/\./g,"")}},{key:"pandocTitle",value:function(e){return(e=e!==this.epubTitle?e.replace(/[^a-zA-Z0-9 ]/g," "):e.replace(/\’/g,"").replace(/[^a-zA-Z0-9.]/g," ")).toLowerCase().replace(/\s\s+/g," ").trim().replace(/\s/g,"-")}},{key:"attrMatches",value:function(e,t,n){return this.$(e).attr(t).match(n)}},{key:"epubLink",value:function(e){if(e.match(/^(https|http|www)/))return e;if(-1!==e.indexOf("#"))return e;var t=r.normalize(e.replace("localhost:1313","")).replace(/^\//,"").replace(/\/$/,"").replace(/\./g,"").replace(/\’/g,"");return t=""!==t?"".concat(t):"#".concat(this.pandocTitle(this.epubTitle))}},{key:"determineTitle",value:function(){var e;return this.content.find("h1")?e=this.content.find("h1").text():this.content.find("h2")&&(e=this.content.find("h2").text()),e||"Cover"}},{key:"determineChapterId",value:function(){var e;return!this.content.find(".quire-contents-header > h1")||void 0!==this.content.find(".quire-contents-header > h1").attr("id")&&(e=this.content.find(".quire-contents-header > h1").attr("id")),!this.content.find("h1.quire-page__header__title")||void 0!==this.content.find("h1.quire-page__header__title").attr("id")&&(e=this.content.find("h1.quire-page__header__title").attr("id")),e||this.epubTitle}},{key:"body",value:function(){return this.$.xml(this.content)}},{key:"href",value:function(){var e=this.$('link[rel="canonical"]');return e?this.epubLink(e.attr("href")):null}},{key:"reformatPage",value:function(){var n,r,i=this;i.content.find('[id*=":"]').attr("id",function(e,t){return t.replace(":","-")}),i.images.attr("src",function(e,t){return"./"+g.resolve(g.join(i.config.outputDir,i.config.imageDir),t).replace(/\/localhost:1313/,i.config.outputDir)}),n={},r=[],i.links.not(function(e,t){return i.attrMatches(t,"href",/^#/)}).attr("href",function(e,t){return"".concat(i.epubLink(t))}),i.links.filter(function(e,t){return-1!==i.$(t).attr("href").indexOf("#")}).filter(function(e,t){return"#"!==i.$(t).attr("href").charAt(0)}).attr("href",function(e,t){return t.toLowerCase()}).attr("href",function(e,t){return decodeURIComponent(t)}).attr("href",function(e,t){return decodeURI(t)}).attr("href",function(e,t){return t.match(/^(https|http|www)/)?t:(t=t.replace("//localhost:1313","").replace(/^\//,"").replace(/\/$/,"").replace(":","-").replace(".","-").replace(/\s/g,"-"),r.push({internalLinksOtherPage:"#".concat(t)}),"".concat(t))}),i.links.filter(function(e,t){return i.attrMatches(t,"href",/^#/)}).filter(function(e,t){return-1===i.$(t).attr("href").indexOf("/")}).attr("href",function(e,t){return t.toLowerCase()}).attr("href",function(e,t){return decodeURIComponent(t)}).attr("href",function(e,t){return decodeURI(t)}).attr("href",function(e,t){return t.replace("#cover","#".concat(i.pandocTitle(i.epubTitle)))}).attr("href",function(e,t){return t!=="#".concat(i.pandocTitle(i.epubTitle))?t.replace(/[^a-zA-Z0-9 ]/g," "):t}).attr("href",function(e,t){return(t=t.substring(1)).replace(/\s\s+/g," ")}).attr("href",function(e,t){return t.replace(":","-")}).attr("href",function(e,t){return(t=(t=""!==t?t:"empty").replace(/\s/g,"-"))!=="".concat(i.pandocTitle(i.epubTitle))?(r.push({internalLinks:"#".concat(t,"-").concat(i.pandocTitle(i.chapterId)),mdPage:"".concat(i.pandocTitle(i.chapterId))}),"#".concat(t,"-").concat(i.pandocTitle(i.chapterId))):(r.push({internalLinks:"#".concat(t)}),"#".concat(t))}),"contents"===i.pandocTitle(i.title)&&i.links.filter(function(e,t){return i.attrMatches(t,"href",/^#/)}).attr("href",function(e,t){return n[t]=(n[t]||0)+1,1<n[t]?(r.push({tocInternalLinks:"".concat(t,"-").concat(n[t])}),t="".concat(t,"-").concat(n[t])):t}),i.reformatedHashLinkArr=r,i.content.find("h1").each(function(e,t){var n=i.$(t).attr("id");return n=void 0!==n?n.toLowerCase().replace(/[^a-zA-Z0-9 ]/g," ").replace(/\s\s+/g," ").replace(/\s/g,"-"):"cover",i.$(t).attr("id",n)}),i.content.find("[id]").not("h1").attr("id",function(e,t){return t.toLowerCase()}).attr("id",function(e,t){return t.replace(/[^a-zA-Z0-9 ]/g," ")}).attr("id",function(e,t){return t.replace(/\s\s+/g," ")}).attr("id",function(e,t){return t.replace(/\s/g,"-")}).attr("id",function(e,t){return"".concat(t,"-").concat(i.pandocTitle(i.chapterId))})}}]),i}();module.exports=b;var y=require("events"),w=require("chalk"),$=require("execa"),k=require("path"),q=require("rimraf"),j=require("child_process").spawnSync,L=require("./utils").commandMissing,P=require("readline"),F=require("./project"),C="git@github.com:gettypubs/quire-starter.git",T="master",_="quire-starter-theme",A=function(e){function t(){var e;return s(this,t),(e=l(this,h(t).call(this))).on("new",e.create),e.on("preview",e.preview),e.on("install",e.install),e.on("site",e.site),e.on("epub",e.epub),e.on("template",e.template),e.on("mobi",e.mobi),e.on("pdf",e.pdf),e.on("error",e.warn),e.on("debug",e.debug),e.once("shutdown",e.shutdown),e.isVerbose=!1,e}var n,r,i,o,a;return p(t,y),u(t,[{key:"create",value:function(i){function o(){return(o=c(x.mark(function e(t,n,r,i,o){return x.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,$("git",t);case 3:return a.notice("Configuring project..."),process.chdir(r),j("git",["checkout","-b","master"]),j("git",["remote","rm","origin"]),j("git",["rm",".gitmodules"]),j("git",["rm","--cached",k.join("themes",_)]),a.notice("Setting up theme..."),process.chdir(n),q.sync(".git"),process.chdir(r),j("git",["add","-A"]),j("git",["commit","-m","Add quire-starter-theme to project"]),a.notice("Installing dependencies..."),a.npmInstall(n),a.confirm("Theme and dependencies successfully installed."),a.notice("Run quire preview in your project folder to view changes locally."),o(!0),e.abrupt("return",!0);case 23:return e.prev=23,e.t0=e.catch(0),a.error(e.t0.message),i(a.error(e.t0.message)),e.abrupt("return",!1);case 28:case"end":return e.stop()}},e,null,[[0,23]])}))).apply(this,arguments)}var a=this;return new Promise(function(e,t){if(L("git"))t(a.emit("warning","Please install Git before continuing.")),a.emit("warning","Please install Git before continuing.");else{a.notice("Installing starter kit...");var n=k.resolve(i),r=k.resolve(i,"themes",_);!function(e,t,n,r,i){o.apply(this,arguments)}(["clone","--recursive","--branch",T,C,i],r,n,t,e)}})}},{key:"preview",value:function(){var t=this;return new Promise(function(e){t.project=new F(t.verbose),t.project.on("info",t.notice),t.project.on("error",function(e){t.error(e),t.shutdown()}),t.project.preview(),t.listen(),e(!0)})}},{key:"site",value:(a=c(x.mark(function e(t){var n;return x.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new F(this.verbose)).on("info",this.notice),n.on("error",this.error),e.prev=3,e.next=6,n.buildWeb(t);case 6:return e.abrupt("return",!0);case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,this,[[3,9]])})),function(e){return a.apply(this,arguments)})},{key:"epub",value:(o=c(x.mark(function e(t,n){var r;return x.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new F(this.verbose)).on("info",this.notice),r.on("error",this.error),e.prev=3,e.next=6,r.buildEpub(t,n);case 6:return e.abrupt("return",!0);case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,this,[[3,9]])})),function(e,t){return o.apply(this,arguments)})},{key:"template",value:function(e){var t=new F(this.verbose);t.on("info",this.notice),t.on("error",this.error),t.downloadTemplate(e)}},{key:"mobi",value:(i=c(x.mark(function e(t,n){var r;return x.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new F(this.verbose)).on("info",this.notice),r.on("error",this.error),e.prev=3,e.next=6,r.buildMobi(t,n);case 6:return e.abrupt("return",!0);case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,this,[[3,9]])})),function(e,t){return i.apply(this,arguments)})},{key:"install",value:(r=c(x.mark(function e(){var t;return x.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new F(this.verbose)).on("info",this.notice),t.on("error",this.error),e.prev=3,e.next=6,t.install();case 6:return e.abrupt("return",!0);case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,this,[[3,9]])})),function(){return r.apply(this,arguments)})},{key:"pdf",value:(n=c(x.mark(function e(t,n){var r;return x.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new F(this.verbose)).on("info",this.notice),r.on("error",this.error),e.prev=3,e.next=6,r.buildPDF(t,n);case 6:return e.abrupt("return",!0);case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,this,[[3,9]])})),function(e,t){return n.apply(this,arguments)})},{key:"debug",value:function(){var e=new F(this.verbose);e.on("info",this.notice),e.on("error",this.error),console.log(e)}},{key:"confirm",value:function(e){console.log(w.green(e))}},{key:"error",value:function(e){console.log(w.red(e)),process.exitCode=1}},{key:"notice",value:function(e){console.log(e)}},{key:"npmInstall",value:function(e){e=e||process.cwd(),j("npm",["install"],{cwd:e},function(e){e&&this.emit("error",e)})}},{key:"shutdown",value:function(e){this.notice("Shutting down Quire"),this.project&&this.project.hasOwnProperty("hugo")&&this.project.hugo&&this.project.hugo.kill(),this.project&&this.project.hasOwnProperty("webpack")&&this.project.webpack&&this.project.webpack.kill(),e||process.exit(),process.exit()}},{key:"warn",value:function(e){console.log(w.yellow(e)),process.exitCode=1}},{key:"listen",value:function(){var n=this,r=P.createInterface({input:process.stdin});r.on("line",function(e){var t=e.replace("quire ","");switch(t){case"stop":n.shutdown(),r.close();break;default:console.log(w.yellow("No method for: ".concat(t)))}})}},{key:"verbose",set:function(e){this.isVerbose=e},get:function(){return this.isVerbose}}]),t}();module.exports=A;var R=require("events"),U=require("lodash"),E=require("axios"),D=require("path"),S=require("url").URL,O=require("striptags"),I=require("./chapter"),B=require("./utils").determineBaseURL,M="http://localhost:1313",H=function(e){function r(e,t){var n;return s(this,r),(n=l(this,h(r).call(this))).data=e,n.config=t,n.outputDir=n.config.outputDir||"site",n.imageDir=n.config.imageDir||"img",n}var t,n;return p(r,R),u(r,[{key:"title",value:function(){return this.data.subtitle&&this.data.reading_line?"".concat(this.data.title,": ").concat(this.data.subtitle," ").concat(this.data.reading_line):this.data.subtitle?"".concat(this.data.title,": ").concat(this.data.subtitle):"".concat(this.data.title)}},{key:"creators",value:function(){if(!this.data.contributor)return!1;var e=U.castArray(this.data.contributor).filter(function(e){return"primary"===e.type});return e.map(function(e){var t=e.full_name||"".concat(e.first_name," ").concat(e.last_name),n={name:t,role:"".concat(e.role||"aut")};return e.last_name&&e.first_name?n["file-as"]="".concat(e.last_name,", ").concat(e.first_name):(t=t.split(" "),n["file-as"]="".concat(t[1],", ").concat(t[0]),n.fullname=!0),n})}},{key:"contributors",value:function(){if(!this.data.contributor)return!1;var e=U.castArray(this.data.contributor).filter(function(e){return"secondary"===e.type});return e.map(function(e){var t=e.full_name||"".concat(e.first_name," ").concat(e.last_name),n={name:t,role:"".concat(e.role||"ctb")};return e.last_name&&e.first_name?n["file-as"]="".concat(e.last_name,", ").concat(e.first_name):(t=t.split(" "),n["file-as"]="".concat(t[1],", ").concat(t[0]),n.fullname=!0),n})}},{key:"publishers",value:function(){if(!this.data.publishers)return!1;var e=U.castArray(this.data.publishers);return e.map(function(e){return e.location?"".concat(e.name,", ").concat(e.location):"".concat(e.name)})}},{key:"loadChapterURLs",value:(n=c(x.mark(function e(){var t,n,r;return x.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.data.chapters,n=t.map(function(e){return E.get(e,{adapter:require("axios/lib/adapters/http")})}),e.next=4,Promise.all(n);case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"cover",value:function(){if(this.data.promo_image){var e=this.getURLforImage(this.data.promo_image);return"".concat(e)}return""}},{key:"generate",value:(t=c(x.mark(function e(){var t,n,r,i=this;return x.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={title:this.title(),cover:this.cover(),url:this.data.publisher[0].url,isbn:this.data.identifier.isbn,language:this.data.language,date:this.data.pub_date,creators:this.creators(),contributors:this.contributors(),publisher:this.data.publisher[0].name,description:O(this.data.description.full).replace(/\r?\n|\r/g," "),rights:this.data.copyright,css:this.getStylesheetUrl()},e.next=3,this.loadChapterURLs();case 3:return n=e.sent,r=n.map(function(e){return new I(e.data,t.title,{outputDir:i.outputDir,imageDir:i.imageDir})}),t.pages=r,e.abrupt("return",new Promise(function(e){return e(t),t}));case 7:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"getURLforImage",value:function(e){var t=this.config.imageDir||"img",n=B(this.config.baseURL),r=D.join(n,t,e);return new S(r,M).href.toLowerCase()}},{key:"getStylesheetUrl",value:function(){var e=B(this.config.baseURL),t=D.join(e,"css","epub.css");return[new S(t,M).href.toLowerCase()]}}]),r}();module.exports=H;module.exports='<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE html>\n<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" $if(lang)$ xml:lang="$lang$" $endif$>\n\n<head>\n    <meta charset="utf-8" />\n    <meta name="generator" content="pandoc" />\n    <title>$pagetitle$</title>\n    <style type="text/css">\n        $if(quotes)$ q {\n            quotes: "“" "”" "‘" "’";\n        }\n\n        $endif$\n    </style>\n    $if(highlighting-css)$\n    <style type="text/css">\n        $highlighting-css$\n    </style>\n    $endif$ $for(css)$\n    <link rel="stylesheet" type="text/css" href="$css$" /> $endfor$ $for(header-includes)$ $header-includes$ $endfor$\n</head>\n<body$if(coverpage)$ id="cover" $endif$>\n    \n    $if(titlepage)$\n    <section epub:type="titlepage">\n        $for(title)$ $if(title.type)$\n        <h1 class="$title.type$">$title.text$</h1>\n        $else$\n        <h1 class="title">$title$</h1>\n        $endif$ $endfor$ $if(subtitle)$\n        <p class="subtitle">$subtitle$</p>\n        $endif$ $for(author)$\n        <p class="author">$author$</p>\n        $endfor$ $for(creator)$\n        <p class="$creator.role$">$creator.text$</p>\n        $endfor$ $if(publisher)$\n        <p class="publisher">$publisher$</p>\n        $endif$ $if(date)$\n        <p class="date">$date$</p>\n        $endif$ $if(rights)$\n        <div class="rights">$rights$</div>\n        $endif$\n    </section>\n    $else$ \n\n    $for(include-before)$ \n    $include-before$ \n    $endfor$ \n    \n    $body$ \n    \n    $for(include-after)$ \n    $include-after$ \n    $endfor$ \n\n    $endif$\n    </body>\n\n</html>';var z=require("commander"),W=new(require("./cli"));process.on("SIGINT",function(){W.emit("shutdown")}),z.version("v0.17.0").option("-v, --verbose","log verbose output").option("-f, --file","Add Filename and optional new filepath").option("-e, --env","Add environment variable"),z.command("new <projectName>").description("Create a new Quire project in the current directory.").action(function(e){W.verbose=z.verbose,W.emit("new",e)}),z.command("preview [options]").description("Run the preview server in the current directory").action(function(){W.verbose=z.verbose,W.emit("preview")}),z.command("install").description("Install this project's theme dependencies").action(function(){W.verbose=z.verbose,W.emit("install")}),z.command("site [env]").option("-e, --env","Add environment variable").alias("build").description("Run the build command in the current directory").action(function(e){W.verbose=z.verbose,W.emit("site",e)}),z.command("pdf [file] [env]").option("-f, --file","Add Filename and optional new filepath").option("-e, --env","Add environment variable").description("Generate a PDF version of the current project").action(function(e,t){W.verbose=z.verbose,W.emit("pdf",e,t)}),z.command("epub [file] [env]").option("-f, --file","Add Filename and optional new filepath").option("-e, --env","Add environment variable").description("Generate an EPUB version of the current project").action(function(e,t){W.verbose=z.verbose,W.emit("epub",e,t)}),z.command("mobi [file] [env]").option("-f, --file","Add Filename and optional new filepath").option("-e, --env","Add environment variable").description("Generate an MOBI version of the current project").action(function(e,t){W.verbose=z.verbose,W.emit("mobi",e,t)}),z.command("template [type]").option("-t, --type","Select template to download (Currently only EPUB supported)").description("Download templates to customize your file output (Currently only EPUB supported)").action(function(e){W.verbose=z.verbose,W.emit("template",e)}),z.command("debug").description("Development use only - log info about current project").action(function(){W.verbose=z.verbose,W.emit("debug")}),z.parse(process.argv);var G=require("events"),Z=require("./epub"),Y=require("./build"),N=require("lodash"),V=require("execa"),Q=require("yaml-front-matter"),J=require("fs-extra"),K=require("glob"),X=require("hugo-bin"),ee=require("path"),te=require("child_process").spawn,ne=require("child_process").spawnSync,re=require("child_process").execFileSync,ie=require("child_process").execSync,oe=require("util").promisify(J.writeFile),ae=require("url").URL,ce=require("./utils"),se=ce.commandMissing,ue=ce.readYAML,le=ce.determineBaseURL,he=require("chalk"),pe=require("kindlegen"),fe=require("ora"),de=require("js-yaml"),me=require("perf_hooks").performance,ve=function(e){function n(e){var t;return s(this,n),(t=l(this,h(n).call(this))).config=t.loadConfig(),t.config.publishDir||(t.config.publishDir="site"),t.theme=t.config.theme,t.chapters=t.loadChapters(),t.verbose=e,t}var r,i,o,t;return p(n,G),u(n,[{key:"getBaseUrl",value:function(e){var t=this;return e.map(function(e){return t.loadConfig(e)}).filter(function(e){return""!==e.baseURL})}},{key:"loadConfig",value:function(e){try{return ue(e||"config.yml")}catch(e){this.emit("error",e)}}},{key:"loadBookData",value:function(){try{return ue(ee.join("data","publication.yml"))}catch(e){this.emit("error",e)}}},{key:"loadChapters",value:function(){var e=K.sync(ee.join(this.config.contentDir||"content","**","*.md"));return N.sortBy(e,function(e){return Q.loadFront(e).weight})}},{key:"isWin",value:function(){return"win32"===process.platform}},{key:"preview",value:function(e){e="webpack/"+(e=void 0!==e?e:"webpack.config.dev.js");var t=this.verbose?"inherit":["pipe","pipe",process.stderr],n=ee.join("themes",this.theme),r=this.isWin()?"webpack.cmd":"webpack",i=ee.join("node_modules",".bin",r);this.emit("info","Launching preview server");var o=fe({text:"Launching preview server"}).start();this.webpack=te(i,["--watch","-d","--progress","--color","--config",e],{cwd:n,stdio:t}),this.hugo=this.spawnHugo("server","--config=config.yml,config/environments/dev.yml","--watch"),o.info("Navigate to http://localhost:1313 to see your changes."),o.info('Press Control+C or type "quire stop" to stop the preview.')}},{key:"install",value:function(){var i=this;return new Promise(function(e){var t=i.config.theme,n=i.isWin()?"npm.cmd":"npm",r=fe({text:"Installing theme dependencies..."}).start();ne(n,["install"],{cwd:ee.join("themes",t),stdio:"inherit"}),r.succeed("Theme dependencies successfully installed."),r.succeed("Run quire preview to view changes locally."),e(!0)})}},{key:"buildTheme",value:function(e,t){t=t.replace(/\/?$/,"/");var n=["--config",e="webpack/"+(e=void 0!==e?e:"webpack.config.dev.js")];-1!==e.indexOf("prod")&&(n.push("--output-public-path"),n.push(t));var r=this.verbose?"inherit":["pipe","pipe",process.stderr],i=this.isWin()?"webpack.cmd":"webpack",o=ee.join("node_modules",".bin",i);return V(o,n,{cwd:ee.join("themes",this.theme),stdio:r})}},{key:"buildWeb",value:(t=c(x.mark(function e(n){var r,i,o,a,c,s=this;return x.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.config.publishDir||"site",i=["config.yml","config/site.yml"],n&&i.push("config/environments/".concat(n,".yml")),i.forEach(function(e){var t=s.loadConfig(e);s.config=N.merge(s.config,t)}),o=""!==this.getBaseUrl(i)?this.getBaseUrl(i):"/",a=void 0!==o[0]?o[0].baseURL:"/",c=fe({text:"Building theme assets..."}).start(),t.prev=7,t.next=10,this.buildTheme("webpack.config.prod.js",a);case 10:return c.stopAndPersist({symbol:"✔ ",text:"Assets built"}),re(X,["--config="+i.join(",")],{stdio:"inherit"}),c.succeed("Site built successfully"),c.succeed("Files output to: ".concat(r)),t.abrupt("return",new Promise(function(e){e(!0)}));case 17:return t.prev=17,t.t0=t.catch(7),t.abrupt("return",new Promise(function(e){e(t.t0),s.errorExit("".concat(t.t0),c)}));case 20:case"end":return t.stop()}},e,this,[[7,17]])})),function(e){return t.apply(this,arguments)})},{key:"getURLforChapter",value:function(e){var t=this.config.contentDir||"content",n=ee.parse(ee.relative(t,e)),r=le(this.config.baseURL),i="http://localhost:1313";if(Q.loadFront(e).url){var o=Q.loadFront(e).url;return new ae(ee.join(r,o),i).href.toLowerCase()}if(Q.loadFront(e).slug){var a=Q.loadFront(e).slug;return new ae(ee.join(r,n.dir,a),i).href.toLowerCase()}return"_index"===n.name||"index"===n.name?new ae(ee.join(r,n.dir),i).href.toLowerCase():new ae(ee.join(r,n.dir,n.name),i).href.toLowerCase()}},{key:"buildPDF",value:(o=c(x.mark(function e(n,r){var i,o,a,c,s,u,l,h,p,f,d,m,v=this;return x.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.checkForFileRemove(ee.join("themes",this.theme,"static","css","application.css"));case 2:return i=this.isWin()?"C:\\Program Files (x86)\\Prince\\engine\\bin\\prince.exe":"prince",o=fe("Building PDF").start(),a=me.now(),this.isWin()||this.checkForCommand(i,o),s=["config.yml","config/pdf.yml"],r&&s.push("config/environments/".concat(r,".yml")),s.forEach(function(e){var t=v.loadConfig(e);v.config=N.merge(v.config,t)}),n=void 0!==n?n:"static/downloads/output",-1!==(u=ee.basename(n)).indexOf(".")&&(u=(n=u.split("."))[0]),l=n.substring(0,n.lastIndexOf("/")),t.prev=13,t.next=16,J.ensureDir(l);case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(13),this.errorExit("".concat(t.t0),o);case 21:return u=void 0!==u&&""!==u?u:"output",h="".concat(l=void 0!==l&&""!==l?l:"static/downloads","/").concat(u),p=""!==this.getBaseUrl(s)?this.getBaseUrl(s):"/",f=void 0!==p[0]?p[0].baseURL:"/",d="http://",f.substr(0,d.length)!==d&&(f=d+f),t.prev=28,t.next=31,this.buildTheme("webpack.config.prod.js",f);case 31:return t.next=33,this.spawnHugo("server","--config="+s.join(","));case 33:return this.hugo=t.sent,t.next=36,this.hugo.ready;case 36:return t.sent&&(m=this.loadChapters(),c=N.filter(m,function(e){return!1!==Q.loadFront(e).pdf}).map(function(e){return v.getURLforChapter(e)}),J.existsSync(ee.join("themes",this.theme,"static","css","application.css")),ie("".concat(i," ").concat(c.toString().replace(/,/g," ")," -o ").concat(h,".pdf --no-warn-css-unsupported --no-warn-css-unknown --no-warn-css")),this.hugo.kill(),o.succeed("PDF output to: ".concat(h,".pdf")),o.info("Execution Time: ".concat(((me.now()-a)/1e3).toFixed(3)," seconds"))),t.abrupt("return",new Promise(function(e){e(!0)}));case 41:return t.prev=41,t.t1=t.catch(28),t.abrupt("return",new Promise(function(e){e(!1),v.hugo.kill(),v.errorExit("".concat(t.t1),o)}));case 44:case"end":return t.stop()}},e,this,[[13,18],[28,41]])})),function(e,t){return o.apply(this,arguments)})},{key:"buildEpub",value:(i=c(x.mark(function e(n,r){var i,o,a,c,s,u,l,h,p,f,d,m,v,g,b,y,w,$,k=this;return x.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.config.publishDir||"site",o=fe("Building EPUB").start(),a=me.now(),this.checkForCommand("pandoc",o),t.next=6,this.checkForFileRemove(ee.join("themes",this.theme,"static","css","epub.css"));case 6:s=["config.yml","config/epub.yml"],r&&s.push("config/environments/".concat(r,".yml")),s.forEach(function(e){var t=k.loadConfig(e);k.config=N.merge(k.config,t)}),t.prev=9,c=de.safeLoad(J.readFileSync("data/publication.yml","utf8")),t.next=17;break;case 13:if(t.prev=13,t.t0=t.catch(9),t.t0)return t.abrupt("return",this.errorExit("".concat(t.t0),o));t.next=17;break;case 17:return void 0!==c.title&&""!==c.title&&null!==c.title||this.errorExit("A title for your publication must be specified in the publication.yml file.",o),void 0!==c.language&&""!==c.language&&null!==c.language||this.errorExit("A language for your publication must be specified in the publication.yml file.",o),u=""!==this.getBaseUrl(s)?this.getBaseUrl(s):"/",l=void 0!==u[0]?u[0].baseURL:"/",t.prev=21,t.next=24,this.spawnHugo("server","--renderToDisk","--config="+s.join(","));case 24:return this.hugo=t.sent,t.next=27,this.buildTheme("webpack.config.epub.js",l);case 27:return t.next=29,this.hugo.ready;case 29:if(t.sent)return t.next=33,J.copy(ee.join("themes",this.theme,"static","css","epub.css"),ee.join(this.config.publishDir,"css","epub.css"));t.next=68;break;case 33:return h=this.loadBookData(),p=this.config,h.chapters=this.chapters.filter(function(e){return!1!==Q.loadFront(e).epub}).map(function(e){return k.getURLforChapter(e)}),t.next=38,new Z(h,p);case 38:return f=t.sent,t.next=41,f.generate();case 41:return d=t.sent,t.next=44,new Y(d,o);case 44:if(m=t.sent,"html/",v=void 0!==n?n:"static/downloads/output",J.existsSync("html/"))return-1!==(g=ee.basename(v)).indexOf(".")&&(g=(n=g.split("."))[0]),b=void 0!==(b=v.substring(0,v.lastIndexOf("/")))&&""!==b?b:"static/downloads",g=void 0!==g&&""!==g?g:"output",t.next=56,J.ensureDir(b);t.next=68;break;case 56:return y=""!==(y=void 0!==m.data.cover?m.data.cover.replace("http://localhost:1313/img/",""):"")?"--epub-cover-image=static/img/".concat(y):"",w="".concat(b,"/").concat(g),$="-f html-native_divs+native_spans -t epub html/epub.xhtml -o ".concat(w,".epub --epub-metadata=html/dc.xml ").concat(y," --template=html/template.xhtml --css=").concat(i,"/css/epub.css -s"),ie("pandoc ".concat($)),o.succeed("Filepath: ".concat(w,".epub")),o.info("Execution Time: ".concat(((me.now()-a)/1e3).toFixed(3)," seconds")),t.next=65,this.checkForFileRemove("site/source.js");case 65:return t.next=67,this.checkForFileRemove(ee.join("themes",this.theme,"static","source.js"));case 67:return t.abrupt("return",new Promise(function(e){e(!0),k.hugo.kill(),m.removeHTML()}));case 68:t.next=73;break;case 70:return t.prev=70,t.t1=t.catch(21),t.abrupt("return",new Promise(function(e){e(!1),k.hugo.kill(),k.errorExit("".concat(t.t1),o)}));case 73:case"end":return t.stop()}},e,this,[[9,13],[21,70]])})),function(e,t){return i.apply(this,arguments)})},{key:"buildMobi",value:(r=c(x.mark(function e(n,r){var i,o,a,c,s,u,l,h,p,f,d,m,v,g,b,y,w,$,k=this;return x.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.config.publishDir||"site",o=fe("Building MOBI").start(),a=me.now(),this.checkForCommand("pandoc",o),t.next=6,this.checkForFileRemove(ee.join("themes",this.theme,"static","css","epub.css"));case 6:s=["config.yml","config/epub.yml"],r&&s.push("config/environments/".concat(r,".yml")),s.forEach(function(e){var t=k.loadConfig(e);k.config=N.merge(k.config,t)}),t.prev=9,c=de.safeLoad(J.readFileSync("data/publication.yml","utf8")),t.next=17;break;case 13:if(t.prev=13,t.t0=t.catch(9),t.t0)return t.abrupt("return",this.errorExit("".concat(t.t0),o));t.next=17;break;case 17:return void 0!==c.title&&""!==c.title&&null!==c.title||this.errorExit("A title for your publication must be specified in the publication.yml file.",o),void 0!==c.language&&""!==c.language&&null!==c.language||this.errorExit("A language for your publication must be specified in the publication.yml file.",o),u=""!==this.getBaseUrl(s)?this.getBaseUrl(s):"/",l=void 0!==u[0]?u[0].baseURL:"/",t.prev=21,t.next=24,this.spawnHugo("server","--renderToDisk","--config="+s.join(","));case 24:return this.hugo=t.sent,t.next=27,this.buildTheme("webpack.config.epub.js",l);case 27:return t.next=29,this.hugo.ready;case 29:if(t.sent)return t.next=33,J.copy(ee.join("themes",this.theme,"static","css","epub.css"),ee.join(this.config.publishDir,"css","epub.css"));t.next=70;break;case 33:return h=this.loadBookData(),p=this.config,h.chapters=this.chapters.filter(function(e){return!1!==Q.loadFront(e).epub}).map(function(e){return k.getURLforChapter(e)}),t.next=38,new Z(h,p);case 38:return f=t.sent,t.next=41,f.generate();case 41:return d=t.sent,t.next=44,new Y(d,o);case 44:if(m=t.sent,"html/",v=void 0!==n?n:"static/downloads/output",J.existsSync("html/"))return-1!==(g=ee.basename(v)).indexOf(".")&&(g=(n=g.split("."))[0]),b=void 0!==(b=v.substring(0,v.lastIndexOf("/")))&&""!==b?b:"static/downloads",g=void 0!==g&&""!==g?g:"output",t.next=56,J.ensureDir(b);t.next=70;break;case 56:return y=""!==(y=void 0!==m.data.cover?m.data.cover.replace("http://localhost:1313/img/",""):"")?"--epub-cover-image=static/img/".concat(y):"",w="".concat(b,"/").concat(g),$="-f html-native_divs+native_spans -t epub html/epub.xhtml -o ".concat(w,"-mobi.epub --epub-metadata=html/dc.xml ").concat(y," --template=html/template.xhtml --css=").concat(i,"/css/epub.css -s"),ie("pandoc ".concat($)),pe(J.readFileSync("".concat(w,"-mobi.epub")),function(e,t){if(e)throw k.errorExit("".concat(e),o);return oe("".concat(w,".mobi"),t),o.succeed("Filepath: ".concat(w,".mobi")),o.info("Execution Time: ".concat(((me.now()-a)/1e3).toFixed(3)," seconds")),new Promise(function(e){e(!0)})}),t.next=64,this.checkForFileRemove("".concat(w,"-mobi.epub"));case 64:return t.next=66,this.checkForFileRemove("site/source.js");case 66:return t.next=68,this.checkForFileRemove(ee.join("themes",this.theme,"static","source.js"));case 68:this.hugo.kill(),m.removeHTML();case 70:t.next=75;break;case 72:return t.prev=72,t.t1=t.catch(21),t.abrupt("return",new Promise(function(e){e(!1),k.hugo.kill(),k.errorExit("".concat(t.t1),o)}));case 75:case"end":return t.stop()}},e,this,[[9,13],[21,72]])})),function(e,t){return r.apply(this,arguments)})},{key:"checkFolderCreated",value:function(i,o){var a=this,c=[];J.readdir(i,function(e,t){if(e)return o(e);var r=t.length;if(!r)return o(null,c);t.forEach(function(n){n=ee.resolve(i,n),J.stat(n,function(e,t){t&&t.isDirectory()?a.checkFolderCreated(n,function(e,t){c=c.concat(t),--r||o(null,c)}):(c.push(n),--r||o(null,c))})})})}},{key:"checkForFileRemove",value:function(t){if(J.existsSync(t))return new Promise(function(e){e(J.unlinkSync(t))})}},{key:"checkForCommand",value:function(e,t){se(e)&&this.errorExit("Please install ".concat(e," before continuing."),t)}},{key:"errorExit",value:function(e,t){t.fail(e),process.exit(1)}},{key:"spawnHugo",value:function(){var n,r,i=this,o="",a=te(X,Array.prototype.slice.call(arguments));return a.ready=new Promise(function(e,t){r=e,n=t}),a.stdout.on("data",function(e){var t=e.toString(),n=he.cyan(t);i.verbose&&console.log(n),-1<t.indexOf("Press Ctrl+C to stop")&&r(t,a)}),a.stderr.on("data",function(e){o+=e.toString()}),a.on("exit",function(e,t){o&&(i.emit("error",o),n(o,a))}),a}}]),n}();module.exports=ve;var ge=require("fs"),be=require("command-exists").sync,ye=require("js-yaml"),we=require("url").URL;module.exports={commandMissing:function(e){return!be(e)},readYAML:function(e){return ye.safeLoad(ge.readFileSync(e,"utf8"))},determineBaseURL:function(t){if("string"==typeof t){-1===t.indexOf("://")&&-1<t.indexOf(":")&&(t="http://"+t);try{return new we(t).pathname}catch(e){if(e instanceof TypeError)return path.parse(t||"").name}}},deleteFolderRecursive:function r(i){ge.existsSync(i)&&(ge.readdirSync(i).forEach(function(e,t){var n=i+"/"+e;ge.statSync(n).isDirectory()?r(n):ge.unlinkSync(n)}),ge.rmdirSync(i))}}}(_regeneratorRuntime,_asyncToGenerator,_classCallCheck,_createClass,_possibleConstructorReturn,_getPrototypeOf,_inherits);
