{{/*
Entry layout. This template is intended for use in catalogue-style pages where
a single image or object needs to be featured prominently.
*/}}

{{ define "main" }}

{{ range .Site.Data.bibliography.biblio_list }}
{{ $refs := replace .reference_for " " "" }}
{{ $refslist := split $refs "," }}

{{ range $refslist }}
{{ if eq . $.Params.id  }}
{{ $.Scratch.Add "a" . }}
{{ end }}
{{ end }}

{{ end }}
{{ $pagebiblio := $.Scratch.Get "a" }}

{{/* Entry content, including entry image and tombstone data */}}
<article class="quire-page quire-entry" id="main" role="main">

  {{/* Full-width entry image header */}}
  {{ with .Params.image }}
  <div class="quire-entry__image">
    <img src="/img/entries/{{ . }}" alt="" />
  </div>
  {{ end }}

  {{/* Entry header */}}
  <header class="section quire-entry__header">
    <div class="container">
      {{/* Title */}}
      <h1 class="title is-size-1">
        {{ with .Params.id }}<span>{{ . }}.</span>{{ end }}
        {{ .Title | markdownify }}
      </h1>

      {{/* Subtitle if any */}}
      {{ with .Params.subtitle }}
      <h2 class="subtitle is-size-3">{{ . }}</h2>
      {{ end }}
    </div>
  </header>

  {{/* Entry tombstone data */}}
  {{ if .Page.Params.object }}
  <section class="section quire-entry__tombstone">
    <div class="container">
      <table class="table is-fullwidth">
        <tbody>
          {{ range $key, $value :=  $.Page.Params.object }}
          <tr><td>{{ $key | title }}</td><td>{{ $value }}</td></tr>
          {{ end }}
        </tbody>
      </table>
    </div>
  </section>
  {{ end }}

  {{ if .Params.abstract }}
  {{ partial "page-abstract.html" . }}
  {{ end }}

  {{/* Entry content */}}
  <section class="section quire-page__content" id="essay-text">
    <div class="container">
      <div class="content">
        {{ .Content }}
      </div>

      {{/* If page byline is set to "bottom", display it here */}}
      {{ if eq .Params.contributor_byline "bottom" }}
      <ul class="quire-page__content__contributor">
        {{- range .Params.contributor -}}
        <li>
          {{ .first_name }} {{ .last_name }}{{ if or .title .affiliation }}<br />
          {{ with .title }}{{ . }}{{ end }}{{ with and .title .affiliation }}, {{ end }}
          {{ with .affiliation }}{{ . }}{{ end }}{{ end }}
        </li>
        {{- end -}}
      </ul>
      {{ end }}
    </div>
  </section>

  <footer class="footer">
    <div class="container">
      {{ partial "references.html" . }}
    </div>
  </footer>

</article>
{{ end }}
